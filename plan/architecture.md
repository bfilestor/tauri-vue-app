# å¥åº·ç®¡ç†ç³»ç»Ÿï¼ˆHealth Guardï¼‰â€” æ¶æ„è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0  
> **æ—¥æœŸ**: 2026-02-12  
> **å…³è”éœ€æ±‚**: [requirement.md](./requirement.md)  
> **æŠ€æœ¯æ ˆ**: Tauri 2 + Vue 3 + Element Plus + TailwindCSS 4 + ECharts + SQLite  
> **ç›®æ ‡å¹³å°**: Windows æ¡Œé¢ç«¯

---

## 1. æ¶æ„æ€»è§ˆ

### 1.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è¡¨ç°å±‚ (Presentation)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Vue 3 SPA (Element Plus + TailwindCSS + ECharts)       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ ä¸Šä¼ é¡µ  â”‚ â”‚ è¶‹åŠ¿é¡µ â”‚ â”‚ è®¾ç½®é¡µ  â”‚ â”‚ é€šç”¨Layoutç»„ä»¶  â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚      â”‚          â”‚          â”‚               â”‚            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚          Composables / API å°è£…å±‚                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  (useCheckup / useTrend / useConfig / useOcr)     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚ @tauri-apps/api invoke              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚          Tauri IPC Bridge (WebView â†” Rust)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨å±‚ (Application)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Tauri Commands å±‚ (src-tauri/src/commands/)   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚record.rs â”‚ â”‚ file.rs  â”‚ â”‚ ocr.rs â”‚ â”‚ ai.rs      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚é¡¹ç›®/è®°å½•  â”‚ â”‚ æ–‡ä»¶ç®¡ç†  â”‚ â”‚OCRè¯†åˆ«  â”‚ â”‚ AIåˆ†æ     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚       â”‚            â”‚           â”‚             â”‚          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚           Services å±‚ (ä¸šåŠ¡é€»è¾‘)                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  OCR Service / AI Service / File Service         â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ db.rs    â”‚  â”‚ http_client  â”‚  â”‚ file_system      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ SQLite   â”‚  â”‚ reqwest+socksâ”‚  â”‚ å›¾ç‰‡å­˜å‚¨          â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **å‰åç«¯åˆ†ç¦»** | Vue 3 è´Ÿè´£ UI æ¸²æŸ“ï¼ŒRust åç«¯è´Ÿè´£æ‰€æœ‰æ•°æ®å¤„ç†å’Œ I/O æ“ä½œ |
| **IPC å•å‘è°ƒç”¨** | å‰ç«¯é€šè¿‡ `invoke` è°ƒç”¨åç«¯å‘½ä»¤ï¼Œåç«¯é€šè¿‡ `Event` æ¨é€å¼‚æ­¥é€šçŸ¥ |
| **API Key å®‰å…¨éš”ç¦»** | æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆAPI Keyã€ä»£ç†å¯†ç ï¼‰ä»…åœ¨ Rust ç«¯ç®¡ç†ï¼Œä¸æš´éœ²ç»™ WebView |
| **ç¦»çº¿å¯ç”¨** | æœ¬åœ°æ•°æ®æµè§ˆå’Œè¶‹åŠ¿åˆ†ææ— éœ€ç½‘ç»œï¼Œä»… OCR å’Œ AI åˆ†æéœ€è”ç½‘ |
| **DDD é¢†åŸŸå»ºæ¨¡** | ä»¥æ£€æŸ¥è®°å½•å’Œæ£€æŸ¥é¡¹ç›®ä¸ºèšåˆæ ¹ï¼Œæ¸…æ™°çš„é¢†åŸŸè¾¹ç•Œ |

---

## 2. å‰ç«¯æ¶æ„

### 2.1 æŠ€æœ¯é€‰å‹

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Vue 3 | 3.5+ | UI æ¡†æ¶ï¼ŒComposition API |
| Vue Router | 4.6+ | SPA è·¯ç”± (Hash æ¨¡å¼) |
| Element Plus | 2.13+ | UI ç»„ä»¶åº“ |
| TailwindCSS | 4.1+ | åŸå­åŒ– CSS |
| ECharts | 6.0+ | è¶‹åŠ¿å›¾è¡¨ |
| vue-echarts | 8.0+ | ECharts Vue å°è£… |
| @tauri-apps/api | 2.x | Tauri IPC é€šä¿¡ |

### 2.2 ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ main.js                    # åº”ç”¨å…¥å£
â”œâ”€â”€ App.vue                    # æ ¹ç»„ä»¶ (Element Plus å›½é™…åŒ–)
â”œâ”€â”€ tray.js                    # ç³»ç»Ÿæ‰˜ç›˜é€»è¾‘
â”‚
â”œâ”€â”€ assets/                    # é™æ€èµ„æº
â”‚   â””â”€â”€ main.css               # å…¨å±€æ ·å¼ + TailwindCSS å…¥å£
â”‚
â”œâ”€â”€ router/
â”‚   â””â”€â”€ index.js               # è·¯ç”±å®šä¹‰ (Hash æ¨¡å¼)
â”‚
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ index.js               # æ’ä»¶ç»Ÿä¸€æ³¨å†Œ
â”‚   â””â”€â”€ modules/               # Element Plus ç­‰æ’ä»¶æ¨¡å—
â”‚
â”œâ”€â”€ api/                       # ğŸ†• Tauri IPC è°ƒç”¨å°è£…å±‚
â”‚   â”œâ”€â”€ checkup.js             # æ£€æŸ¥è®°å½• CRUD
â”‚   â”œâ”€â”€ file.js                # æ–‡ä»¶ä¸Šä¼ /é¢„è§ˆ/åˆ é™¤
â”‚   â”œâ”€â”€ ocr.js                 # OCR ç›¸å…³å‘½ä»¤
â”‚   â”œâ”€â”€ ai.js                  # AI åˆ†æå‘½ä»¤
â”‚   â”œâ”€â”€ project.js             # æ£€æŸ¥é¡¹ç›®ç®¡ç†
â”‚   â”œâ”€â”€ indicator.js           # æ£€æŸ¥æŒ‡æ ‡ç®¡ç†
â”‚   â”œâ”€â”€ trend.js               # è¶‹åŠ¿æ•°æ®æŸ¥è¯¢
â”‚   â””â”€â”€ config.js              # ç³»ç»Ÿé…ç½®è¯»å†™
â”‚
â”œâ”€â”€ composables/               # ğŸ†• ç»„åˆå¼å‡½æ•° (ä¸šåŠ¡é€»è¾‘å¤ç”¨)
â”‚   â”œâ”€â”€ useCheckupRecord.js    # æ£€æŸ¥è®°å½•çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useFileUpload.js       # æ–‡ä»¶ä¸Šä¼ é€»è¾‘
â”‚   â”œâ”€â”€ useOcr.js              # OCR æµç¨‹æ§åˆ¶
â”‚   â”œâ”€â”€ useAiAnalysis.js       # AI åˆ†ææµç¨‹
â”‚   â”œâ”€â”€ useTrend.js            # è¶‹åŠ¿å›¾æ•°æ®
â”‚   â””â”€â”€ useConfig.js           # é…ç½®è¯»å†™
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/                # åº”ç”¨å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ index.vue          # ä¸»å¸ƒå±€å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ header/            # æ ‡é¢˜æ  (è‡ªå®šä¹‰æ— è¾¹æ¡†çª—å£)
â”‚   â”‚   â”œâ”€â”€ side/              # ä¾§è¾¹å¯¼èˆª
â”‚   â”‚   â””â”€â”€ main/              # å†…å®¹åŒº
â”‚   â”œâ”€â”€ common/                # ğŸ†• é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ FileUploader.vue   # æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ (æ‹–æ‹½+é€‰æ‹©)
â”‚   â”‚   â”œâ”€â”€ ImagePreview.vue   # å›¾ç‰‡é¢„è§ˆç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ StatusTag.vue      # çŠ¶æ€æ ‡ç­¾ (å¾…OCR/å·²OCR/å·²åˆ†æ)
â”‚   â”‚   â””â”€â”€ MarkdownViewer.vue # Markdown æ¸²æŸ“ç»„ä»¶
â”‚   â””â”€â”€ charts/                # ğŸ†• å›¾è¡¨ç»„ä»¶
â”‚       â”œâ”€â”€ TrendChart.vue     # è¶‹åŠ¿æŠ˜çº¿/æŸ±çŠ¶å›¾
â”‚       â””â”€â”€ ComparisonCard.vue # å‰åå¯¹æ¯”å¡ç‰‡
â”‚
â””â”€â”€ views/                     # é¡µé¢è§†å›¾
    â”œâ”€â”€ upload/
    â”‚   â””â”€â”€ index.vue          # æ£€æŸ¥æ•°æ®ä¸Šä¼ ä¸å­˜æ¡£é¡µ
    â”œâ”€â”€ trends/
    â”‚   â””â”€â”€ index.vue          # è¶‹åŠ¿åˆ†æé¡µ
    â””â”€â”€ settings/
        â””â”€â”€ index.vue          # ç³»ç»Ÿè®¾ç½®é¡µ
```

### 2.3 è·¯ç”±è®¾è®¡

```
/                      â†’ é‡å®šå‘åˆ° /upload
â”œâ”€â”€ /upload            â†’ æ£€æŸ¥æ•°æ®ä¸Šä¼ ä¸å­˜æ¡£ï¼ˆé»˜è®¤é¦–é¡µï¼‰
â”œâ”€â”€ /trends            â†’ è¶‹åŠ¿åˆ†æ
â””â”€â”€ /settings          â†’ ç³»ç»Ÿè®¾ç½®
```

æ‰€æœ‰é¡µé¢ä¸º Layout å­è·¯ç”±ï¼Œå…±äº«é¡¶éƒ¨æ ‡é¢˜æ å’Œä¾§è¾¹å¯¼èˆªæ ã€‚é‡‡ç”¨ `keepAlive` ç¼“å­˜é¡µé¢çŠ¶æ€ã€‚

### 2.4 API å°è£…å±‚è®¾è®¡

å‰ç«¯é€šè¿‡ç»Ÿä¸€çš„ API å±‚ä¸ Rust åç«¯é€šä¿¡ï¼Œéš”ç¦» Tauri `invoke` è°ƒç”¨ç»†èŠ‚ï¼š

```javascript
// src/api/checkup.js ç¤ºä¾‹
import { invoke } from '@tauri-apps/api/core'

export const createCheckupRecord = (checkupDate) =>
  invoke('create_record', { checkupDate })

export const listCheckupRecords = (page, size, dateRange) =>
  invoke('list_records', { page, size, dateRange })

export const getCheckupRecord = (id) =>
  invoke('get_record', { id })

export const deleteCheckupRecord = (id) =>
  invoke('delete_record', { id })
```

### 2.5 å‰ç«¯çŠ¶æ€ç®¡ç†ç­–ç•¥

æœ¬ç³»ç»Ÿé‡‡ç”¨ **Composables (ç»„åˆå¼å‡½æ•°)** ç®¡ç†çŠ¶æ€ï¼Œä¸å¼•å…¥ Pinia/Vuexï¼š

- æ¯ä¸ªä¸šåŠ¡é¢†åŸŸä¸€ä¸ª composableï¼Œå†…éƒ¨ç®¡ç† `ref`/`reactive` çŠ¶æ€
- é€šè¿‡ `provide/inject` åœ¨ç»„ä»¶æ ‘é—´å…±äº«çŠ¶æ€
- å¼‚æ­¥æ“ä½œç»Ÿä¸€ä½¿ç”¨ `async/await`ï¼Œé…åˆ Element Plus çš„ Loading å’Œ Notification

---

## 3. åç«¯æ¶æ„ (Rust / Tauri)

### 3.1 æŠ€æœ¯é€‰å‹

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Tauri | 2.10+ | æ¡Œé¢åº”ç”¨æ¡†æ¶ |
| rusqlite | 0.34 | SQLite æ•°æ®åº“é©±åŠ¨ (bundled) |
| reqwest | 0.12 | HTTP å®¢æˆ·ç«¯ (å« SOCKS ä»£ç†æ”¯æŒ) |
| tokio | 1.x | å¼‚æ­¥è¿è¡Œæ—¶ |
| serde / serde_json | 1.x | åºåˆ—åŒ–/ååºåˆ—åŒ– |
| uuid | 1.x | UUID ä¸»é”®ç”Ÿæˆ |
| chrono | 0.4 | æ—¶é—´å¤„ç† |
| base64 | 0.22 | å›¾ç‰‡ Base64 ç¼–è§£ç  |

### 3.2 ç›®å½•ç»“æ„

```
src-tauri/src/
â”œâ”€â”€ main.rs                    # å…¥å£ (è°ƒç”¨ lib::run)
â”œâ”€â”€ lib.rs                     # Tauri Builder é…ç½®ã€çŠ¶æ€æ³¨å…¥
â”œâ”€â”€ db.rs                      # æ•°æ®åº“åˆå§‹åŒ–ã€å»ºè¡¨
â”‚
â”œâ”€â”€ commands/                  # Tauri å‘½ä»¤å±‚ (å¯¹åº”å‰ç«¯ API)
â”‚   â”œâ”€â”€ mod.rs                 # æ¨¡å—å¯¼å‡º + AppDir çŠ¶æ€ç»“æ„
â”‚   â”œâ”€â”€ record.rs              # æ£€æŸ¥è®°å½• CRUD
â”‚   â”œâ”€â”€ file.rs                # æ–‡ä»¶ä¸Šä¼ /è¯»å–/åˆ é™¤
â”‚   â”œâ”€â”€ project.rs             # æ£€æŸ¥é¡¹ç›®ç®¡ç†
â”‚   â”œâ”€â”€ indicator.rs           # æ£€æŸ¥æŒ‡æ ‡ç®¡ç†
â”‚   â”œâ”€â”€ config.rs              # ç³»ç»Ÿé…ç½®è¯»å†™
â”‚   â”œâ”€â”€ ocr.rs                 # ğŸ†• OCR è¯†åˆ«å‘½ä»¤
â”‚   â”œâ”€â”€ ai.rs                  # ğŸ†• AI åˆ†æå‘½ä»¤
â”‚   â””â”€â”€ trend.rs               # ğŸ†• è¶‹åŠ¿æ•°æ®æŸ¥è¯¢å‘½ä»¤
â”‚
â”œâ”€â”€ services/                  # ğŸ†• ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ ocr_service.rs         # OCR è¯·æ±‚æ„å»ºä¸è§£æ
â”‚   â”œâ”€â”€ ai_service.rs          # AI Prompt æ„å»ºä¸æµå¼è¯·æ±‚
â”‚   â””â”€â”€ http_client.rs         # HTTP å®¢æˆ·ç«¯ (å« SOCKS ä»£ç†)
â”‚
â””â”€â”€ models/                    # ğŸ†• æ•°æ®æ¨¡å‹ (Serde ç»“æ„ä½“)
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ record.rs              # CheckupRecord
    â”œâ”€â”€ file.rs                # CheckupFile
    â”œâ”€â”€ project.rs             # CheckupProject
    â”œâ”€â”€ indicator.rs           # Indicator / IndicatorValue
    â”œâ”€â”€ ocr.rs                 # OcrResult
    â”œâ”€â”€ ai.rs                  # AiAnalysis
    â””â”€â”€ config.rs              # SystemConfig
```

### 3.3 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Commands å±‚ (commands/*.rs)            â”‚  â† Tauri #[command] å®æ ‡æ³¨
â”‚  èŒè´£ï¼šå‚æ•°æ ¡éªŒã€è°ƒç”¨ Serviceã€è¿”å›ç»“æœ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Services å±‚ (services/*.rs)            â”‚  â† çº¯ä¸šåŠ¡é€»è¾‘
â”‚  èŒè´£ï¼šOCR/AI è¯·æ±‚æ„å»ºã€æ•°æ®è½¬æ¢          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Models å±‚ (models/*.rs)                â”‚  â† Serde æ•°æ®ç»“æ„
â”‚  èŒè´£ï¼šå®šä¹‰è¯·æ±‚/å“åº”çš„æ•°æ®ç»“æ„            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DAL å±‚ (db.rs)                         â”‚  â† rusqlite æ“ä½œ
â”‚  èŒè´£ï¼šSQL æ‰§è¡Œã€æ•°æ®åº“åˆå§‹åŒ–             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 çŠ¶æ€ç®¡ç†

Tauri é€šè¿‡ `app.manage()` æ³¨å…¥å…¨å±€çŠ¶æ€ï¼Œå„ Command é€šè¿‡ `State<T>` è·å–ï¼š

| çŠ¶æ€ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `Database` | `Database { conn: Mutex<Connection> }` | SQLite è¿æ¥ï¼ˆMutex ä¿æŠ¤çº¿ç¨‹å®‰å…¨ï¼‰ |
| `AppDir` | `AppDir(PathBuf)` | åº”ç”¨æ•°æ®æ ¹ç›®å½•è·¯å¾„ |

### 3.5 å¼‚æ­¥å¤„ç†æ¨¡å‹

```
å‰ç«¯ invoke("start_ocr")
    â”‚
    â–¼
Commands å±‚ (åŒæ­¥å¯åŠ¨ä»»åŠ¡ï¼Œç«‹å³è¿”å› task_id)
    â”‚
    â”œâ”€ tokio::spawn â”€â”€â–¶  OCR Service (å¼‚æ­¥æ‰§è¡Œ HTTP è¯·æ±‚)
    â”‚                         â”‚
    â”‚                         â”œâ”€ é€æ–‡ä»¶è°ƒç”¨ AI è§†è§‰ API
    â”‚                         â”œâ”€ è§£æè¿”å›ç»“æœ â†’ å†™å…¥ ocr_results
    â”‚                         â”œâ”€ æå–æŒ‡æ ‡å€¼ â†’ å†™å…¥ indicator_values
    â”‚                         â””â”€ å®Œæˆå â†’ app.emit("ocr_complete", payload)
    â”‚
    â–¼
å‰ç«¯ç›‘å¬ Event("ocr_complete") â†’ æ›´æ–°UI + å¼¹å‡ºé€šçŸ¥
```

AI åˆ†æåŒç†ï¼Œæ”¯æŒæµå¼è¿”å›ï¼š

```
å‰ç«¯ invoke("start_ai_analysis")
    â”‚
    â–¼
Commands å±‚ â†’ tokio::spawn
    â”‚
    â”œâ”€ ç»„è£… Promptï¼ˆå½“å‰ + å†å²æ•°æ®ï¼‰
    â”œâ”€ reqwest æµå¼è¯·æ±‚ AI API
    â”œâ”€ é€ chunk â†’ app.emit("ai_stream_chunk", { content })
    â””â”€ å®Œæˆ   â†’ app.emit("ai_stream_done", { analysis_id })
    
å‰ç«¯ç›‘å¬ ai_stream_chunk â†’ å®æ—¶è¿½åŠ æ¸²æŸ“ Markdown
å‰ç«¯ç›‘å¬ ai_stream_done  â†’ æ ‡è®°å®Œæˆ
```

---

## 4. æ•°æ®æ¶æ„

### 4.1 æ•°æ®åº“ ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ checkup_projects â”‚       â”‚   indicators     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 1   N â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)          â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ project_id (FK)  â”‚
â”‚ name             â”‚       â”‚ id (PK)          â”‚
â”‚ description      â”‚       â”‚ name             â”‚
â”‚ sort_order       â”‚       â”‚ unit             â”‚
â”‚ is_active        â”‚       â”‚ reference_range  â”‚
â”‚ created_at       â”‚       â”‚ sort_order       â”‚
â”‚ updated_at       â”‚       â”‚ is_core          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚
       â”‚ 1                        â”‚ 1
       â”‚ N                        â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ checkup_files    â”‚       â”‚ indicator_values  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)          â”‚       â”‚ id (PK)          â”‚
â”‚ record_id (FK)â”€â”€â”€â”¤       â”‚ ocr_result_id(FK)â”‚
â”‚ project_id (FK)  â”‚       â”‚ record_id (FK)â”€â”€â”€â”¤
â”‚ original_filenameâ”‚       â”‚ project_id (FK)  â”‚
â”‚ stored_path      â”‚       â”‚ indicator_id(FK) â”‚
â”‚ file_size        â”‚       â”‚ checkup_date     â”‚
â”‚ mime_type        â”‚       â”‚ value            â”‚
â”‚ uploaded_at      â”‚       â”‚ value_text       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ is_abnormal      â”‚
       â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1                        â–²
       â”‚ N                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  ocr_results     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)          â”‚
â”‚ file_id (FK)     â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ record_id (FK)â”€â”€â”€â”¤       â”‚ checkup_records  â”‚
â”‚ project_id (FK)  â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ checkup_date     â”‚  N  1 â”‚ id (PK)          â”‚
â”‚ raw_json         â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ checkup_date     â”‚
â”‚ parsed_items     â”‚       â”‚ status           â”‚
â”‚ status           â”‚       â”‚ notes            â”‚
â”‚ error_message    â”‚       â”‚ created_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ updated_at       â”‚
                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ 1
                                  â”‚ N
                           â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  ai_analyses     â”‚
                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                           â”‚ id (PK)          â”‚
                           â”‚ record_id (FK)   â”‚
                           â”‚ request_prompt   â”‚
                           â”‚ response_content â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ model_used       â”‚    â”‚  system_config   â”‚
                           â”‚ status           â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                           â”‚ error_message    â”‚    â”‚ id (PK)          â”‚
                           â”‚ created_at       â”‚    â”‚ config_key (UQ)  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ config_value     â”‚
                                                   â”‚ updated_at       â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å…³é”®æ•°æ®æµ

```
ã€ä¸Šä¼ æµç¨‹ã€‘
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ â†’ å‰ç«¯åˆ†é¡¹ç›®ç»„ç»‡ â†’ invoke upload_files
    â†’ Rust å¤åˆ¶æ–‡ä»¶åˆ° pictures/{é¡¹ç›®å}/{æ—¥æœŸ}/
    â†’ å†™å…¥ checkup_files è¡¨ â†’ è¿”å›ç»“æœ

ã€OCR æµç¨‹ã€‘
invoke start_ocr â†’ Rust è¯»å– record å…³è”çš„æ‰€æœ‰ file
    â†’ å›¾ç‰‡è½¬ Base64 â†’ æŒ‰é¡¹ç›®åˆ†ç»„
    â†’ HTTP POST åˆ° AI è§†è§‰ API (å¸¦ SOCKS ä»£ç†)
    â†’ è§£æ JSON å“åº” â†’ å†™å…¥ ocr_results
    â†’ æ­£åˆ™/æ¨¡æ¿åŒ¹é…æå–æŒ‡æ ‡å€¼ â†’ å†™å…¥ indicator_values
    â†’ emit("ocr_complete")

ã€AI åˆ†ææµç¨‹ã€‘
invoke start_ai_analysis â†’ Rust æŸ¥è¯¢å½“æ¬¡ + å†å² OCR æ•°æ®
    â†’ ç»„è£… Prompt (æ¨¡æ¿ + æ•°æ®)
    â†’ reqwest stream è¯·æ±‚ AI Chat API
    â†’ é€ chunk emit("ai_stream_chunk")
    â†’ å®Œæˆå†™å…¥ ai_analyses â†’ emit("ai_stream_done")

ã€è¶‹åŠ¿æŸ¥è¯¢æµç¨‹ã€‘
invoke get_indicator_trend â†’ Rust æŸ¥è¯¢ indicator_values
    â†’ æŒ‰ checkup_date æ’åº â†’ å…³è” indicators è·å–å‚è€ƒèŒƒå›´
    â†’ è¿”å› Vec<TrendPoint> â†’ å‰ç«¯ ECharts æ¸²æŸ“
```

### 4.3 æ–‡ä»¶å­˜å‚¨è§„èŒƒ

```
{åº”ç”¨æ ¹ç›®å½•}/
â”œâ”€â”€ health_guard.db              # SQLite æ•°æ®åº“
â””â”€â”€ pictures/                    # æ£€æŸ¥æŠ¥å‘Šå›¾ç‰‡
    â””â”€â”€ {é¡¹ç›®åç§°}/              # å¦‚: è¡€å¸¸è§„ã€è‚åŠŸèƒ½
        â””â”€â”€ {YYYY-MM-DD}/        # æ£€æŸ¥æ—¥æœŸ
            â””â”€â”€ {åŸå§‹æ–‡ä»¶å}      # å¦‚: report_page1.jpg
```

- è·¯å¾„ä¸­çš„ `stored_path` å­—æ®µå­˜å‚¨ç›¸å¯¹äºåº”ç”¨æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„
- æ–‡ä»¶å‘½åå†²çªæ—¶è¿½åŠ æ•°å­—åç¼€ï¼ˆå¦‚ `report_page1_2.jpg`ï¼‰

---

## 5. æ¥å£æ¶æ„ (Tauri Commands)

### 5.1 å‘½ä»¤åˆ†ç»„

| æ¨¡å— | æ–‡ä»¶ | å‘½ä»¤åˆ—è¡¨ | çŠ¶æ€ |
|------|------|---------|------|
| æ£€æŸ¥è®°å½• | `record.rs` | `create_record`, `list_records`, `get_record`, `update_record`, `delete_record` | âœ… å·²å®ç° |
| æ–‡ä»¶ç®¡ç† | `file.rs` | `upload_files`, `list_files`, `read_file_base64`, `delete_file` | âœ… å·²å®ç° |
| æ£€æŸ¥é¡¹ç›® | `project.rs` | `list_projects`, `create_project`, `update_project`, `delete_project` | âœ… å·²å®ç° |
| æ£€æŸ¥æŒ‡æ ‡ | `indicator.rs` | `list_indicators`, `create_indicator`, `update_indicator`, `delete_indicator` | âœ… å·²å®ç° |
| ç³»ç»Ÿé…ç½® | `config.rs` | `get_config`, `save_config` | âœ… å·²å®ç° |
| OCR è¯†åˆ« | `ocr.rs` | `start_ocr`, `get_ocr_status`, `get_ocr_results` | ğŸ”² å¾…å¼€å‘ |
| AI åˆ†æ | `ai.rs` | `start_ai_analysis`, `get_ai_analysis` | ğŸ”² å¾…å¼€å‘ |
| è¶‹åŠ¿åˆ†æ | `trend.rs` | `get_indicator_trend`, `get_latest_comparison` | ğŸ”² å¾…å¼€å‘ |
| ç³»ç»Ÿ | `lib.rs` | `quit`, `test_ai_connection` | éƒ¨åˆ†å®ç° |

### 5.2 ç»Ÿä¸€å“åº”æ ¼å¼

```rust
// Tauri Command ç»Ÿä¸€ä½¿ç”¨ Result<T, String> è¿”å›
#[tauri::command]
fn example_command() -> Result<SomeData, String> {
    // æˆåŠŸè¿”å› Ok(data)
    // å¤±è´¥è¿”å› Err("ä¸­æ–‡é”™è¯¯æè¿°".into())
}
```

å‰ç«¯æ”¶åˆ°çš„ JSON æ ¼å¼ï¼š
- æˆåŠŸï¼šç›´æ¥è¿”å›æ•°æ®å¯¹è±¡
- å¤±è´¥ï¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ`catch` ä¸­è·å–é”™è¯¯å­—ç¬¦ä¸²

---

## 6. å¤–éƒ¨æœåŠ¡é›†æˆ

### 6.1 AI / OCR æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTPS (å¯é€‰ SOCKS5 ä»£ç†)     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rust åç«¯    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  AI API æœåŠ¡      â”‚
â”‚  reqwest      â”‚                                  â”‚  (OpenAI å…¼å®¹)    â”‚
â”‚  + socks      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     JSON / SSE Stream             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 HTTP å®¢æˆ·ç«¯é…ç½®

```rust
// services/http_client.rs ä¼ªä»£ç 
pub fn build_client(config: &AiConfig) -> reqwest::Client {
    let mut builder = reqwest::Client::builder()
        .timeout(Duration::from_secs(120));
    
    if config.socks_proxy_enabled {
        let proxy = reqwest::Proxy::all(&config.proxy_address)?;
        // å¯é€‰è®¤è¯
        if !config.proxy_username.is_empty() {
            proxy = proxy.basic_auth(&config.proxy_username, &config.proxy_password);
        }
        builder = builder.proxy(proxy);
    }
    
    builder.build()
}
```

### 6.3 é…ç½®å­˜å‚¨ç»“æ„ (system_config è¡¨)

| config_key | config_value ç»“æ„ |
|------------|------------------|
| `ai_api` | `{ "url": "...", "api_key": "...", "models": [...], "default_model": "..." }` |
| `socks_proxy` | `{ "enabled": false, "address": "...", "username": "", "password": "" }` |
| `ocr_settings` | `{ "engine": "ai_vision", "prompt_template": "..." }` |
| `ai_analysis_prompt` | `{ "template": "..." }` |

---

## 7. å®‰å…¨æ¶æ„

### 7.1 å®‰å…¨è¾¹ç•Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebView (ä¸å¯ä¿¡åŒºåŸŸ)                 â”‚
â”‚  - æ— æ³•ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿ               â”‚
â”‚  - æ— æ³•ç›´æ¥å‘é€ HTTP è¯·æ±‚             â”‚
â”‚  - ä¸æŒæœ‰ API Key                    â”‚
â”‚  - é€šè¿‡ invoke è¯·æ±‚ Rust æ‰§è¡Œæ“ä½œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ IPC (invoke/event)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rust åç«¯ (å¯ä¿¡åŒºåŸŸ)                 â”‚
â”‚  - ç®¡ç† API Key (å­˜ SQLite + å†…å­˜)   â”‚
â”‚  - æ§åˆ¶æ–‡ä»¶è¯»å†™èŒƒå›´ (ä»… pictures/)    â”‚
â”‚  - å‘èµ·å¤–éƒ¨ HTTP è¯·æ±‚                â”‚
â”‚  - æ‰§è¡Œæ•°æ®åº“æ“ä½œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å®‰å…¨æªæ–½

| æªæ–½ | è¯´æ˜ |
|------|------|
| API Key éš”ç¦» | å­˜å‚¨åœ¨ SQLiteï¼Œä»…åœ¨ Rust ç«¯å†…å­˜ä¸­ä½¿ç”¨ |
| CSP ç­–ç•¥ | `tauri.conf.json` ä¸­æŒ‰éœ€é…ç½® Content-Security-Policy |
| æ–‡ä»¶è·¯å¾„æ ¡éªŒ | æ–‡ä»¶æ“ä½œé™åˆ¶åœ¨ `app_dir/pictures/` ç›®å½•å†…ï¼Œé˜²æ­¢è·¯å¾„ç©¿è¶Š |
| å•å®ä¾‹é” | `tauri-plugin-single-instance` é˜²æ­¢å¤šå®ä¾‹è¿è¡Œ |
| æ•°æ®åº“ WAL | `PRAGMA journal_mode=WAL` é˜²æ­¢å†™å…¥å†²çª |

---

## 8. æ€§èƒ½è®¾è®¡

### 8.1 æ–‡ä»¶ä¸Šä¼ 

- å‰ç«¯åˆ†ç»„é€‰æ‹©æ–‡ä»¶åä¸€æ¬¡æ€§ invokeï¼ŒRust ç«¯å¹¶å‘å¤åˆ¶æ–‡ä»¶
- å¤§æ–‡ä»¶é‡‡ç”¨æµå¼è¯»å†™ï¼Œé¿å…å†…å­˜å³°å€¼
- ä¸Šä¼ å®Œæˆåæ‰¹é‡æ’å…¥ `checkup_files` è®°å½•ï¼ˆäº‹åŠ¡åŒ…è£¹ï¼‰

### 8.2 OCR / AI å¼‚æ­¥

- OCR å’Œ AI åˆ†æä½¿ç”¨ `tokio::spawn` å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ UI
- é€šè¿‡ Tauri Event æœºåˆ¶æ¨é€è¿›åº¦å’Œå®Œæˆé€šçŸ¥
- è¶…æ—¶æ§åˆ¶ï¼šå•æ¬¡ OCR è¯·æ±‚ 120 ç§’ï¼ŒAI åˆ†æ 300 ç§’
- å¤±è´¥æ—¶è®°å½• `error_message`ï¼Œæ”¯æŒæ‰‹åŠ¨é‡è¯•

### 8.3 è¶‹åŠ¿æŸ¥è¯¢

- æŒ‡æ ‡å€¼æŸ¥è¯¢ä½¿ç”¨ SQLite ç´¢å¼•åŠ é€Ÿï¼š`(indicator_id, checkup_date)`
- å‰ç«¯ ECharts ä½¿ç”¨è™šæ‹Ÿæ¸²æŸ“ï¼Œæ”¯æŒå¤§é‡æ•°æ®ç‚¹
- æŸ¥è¯¢ç»“æœå¯æŒ‰æ—¥æœŸèŒƒå›´è¿‡æ»¤ï¼Œå‡å°‘æ•°æ®é‡

### 8.4 SQLite ä¼˜åŒ–

```sql
-- å»ºè®®æ·»åŠ çš„ç´¢å¼•
CREATE INDEX idx_indicator_values_trend 
  ON indicator_values(indicator_id, checkup_date);

CREATE INDEX idx_checkup_files_record 
  ON checkup_files(record_id);

CREATE INDEX idx_ocr_results_record 
  ON ocr_results(record_id);
```

---

## 9. é”™è¯¯å¤„ç†ç­–ç•¥

### 9.1 åç«¯é”™è¯¯å¤„ç†

```rust
// ç»Ÿä¸€é”™è¯¯è½¬æ¢ä¸ºä¸­æ–‡å‹å¥½æç¤º
fn map_error(e: impl std::fmt::Display, context: &str) -> String {
    log::error!("{}: {}", context, e);
    format!("{}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•", context)
}
```

### 9.2 å‰ç«¯é”™è¯¯å¤„ç†

```javascript
// composable ä¸­ç»Ÿä¸€å¤„ç†
const handleApiError = (error, fallbackMsg = 'æ“ä½œå¤±è´¥') => {
  ElNotification({
    title: 'æ“ä½œæç¤º',
    message: error || fallbackMsg,
    type: 'error',
    duration: 4000,
  })
}
```

### 9.3 ç½‘ç»œå¼‚å¸¸é‡è¯•

- OCR å’Œ AI è¯·æ±‚å¤±è´¥è‡ªåŠ¨é‡è¯• 1 æ¬¡ï¼ˆé—´éš” 3 ç§’ï¼‰
- è¶…è¿‡é‡è¯•æ¬¡æ•°åè®°å½•é”™è¯¯çŠ¶æ€ï¼ŒUI æä¾›æ‰‹åŠ¨é‡è¯•æŒ‰é’®
- æ–­ç½‘æ£€æµ‹ï¼šè¯·æ±‚å‰å¯é€‰ ping æµ‹è¯•

---

## 10. éƒ¨ç½²ä¸æ„å»º

### 10.1 å¼€å‘æ¨¡å¼

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (Vite + Tauri)
npm run tauri dev
```

### 10.2 ç”Ÿäº§æ„å»º

```bash
# æ„å»º Windows å®‰è£…åŒ… (NSIS)
npm run tauri build
```

è¾“å‡ºäº§ç‰©ï¼š`src-tauri/target/release/bundle/nsis/`

### 10.3 è¿è¡Œç¯å¢ƒè¦æ±‚

| é¡¹ç›® | è¦æ±‚ |
|------|------|
| æ“ä½œç³»ç»Ÿ | Windows 10/11 64-bit |
| è¿è¡Œæ—¶ | WebView2 (Windows è‡ªå¸¦) |
| ç£ç›˜ | â‰¥ 100MB (å«æ•°æ®åº“å’Œå›¾ç‰‡) |
| ç½‘ç»œ | ä»… OCR/AI åˆ†æéœ€è¦ (å¯é…ä»£ç†) |

---

## 11. å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶ âœ…
- [x] Tauri 2 + Vue 3 + Element Plus é¡¹ç›®æ­å»º
- [x] TailwindCSS é›†æˆ
- [x] è‡ªå®šä¹‰æ— è¾¹æ¡†çª—å£ + ç³»ç»Ÿæ‰˜ç›˜
- [x] SQLite æ•°æ®åº“åˆå§‹åŒ–ï¼ˆ8 å¼ è¡¨ï¼‰
- [x] æ£€æŸ¥é¡¹ç›®/æŒ‡æ ‡ CRUD
- [x] æ£€æŸ¥è®°å½• CRUD
- [x] æ–‡ä»¶ä¸Šä¼ /ç®¡ç†

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ ğŸ”²
- [ ] OCR è¯†åˆ«æ¨¡å— (ocr.rs + ocr_service.rs)
- [ ] AI åˆ†ææ¨¡å— (ai.rs + ai_service.rs)
- [ ] HTTP å®¢æˆ·ç«¯ + SOCKS ä»£ç†æ”¯æŒ
- [ ] ç³»ç»Ÿè®¾ç½®é¡µé¢å®Œå–„ (AI é…ç½® / ä»£ç†é…ç½®)
- [ ] å‰ç«¯ OCR æµç¨‹ UI
- [ ] å‰ç«¯ AI åˆ†ææµç¨‹ UI (æµå¼æ¸²æŸ“)

### Phase 3: è¶‹åŠ¿åˆ†æ ğŸ”²
- [ ] è¶‹åŠ¿æ•°æ®æŸ¥è¯¢æ¥å£ (trend.rs)
- [ ] ECharts è¶‹åŠ¿å›¾ç»„ä»¶
- [ ] æŒ‡æ ‡é€‰æ‹©æ ‘ç»„ä»¶
- [ ] å‚è€ƒèŒƒå›´é˜´å½± + å¼‚å¸¸å€¼é«˜äº®
- [ ] æœ€æ–°/ä¸Šæ¬¡å¯¹æ¯”å¡ç‰‡

### Phase 4: ä¼˜åŒ–å®Œå–„ ğŸ”²
- [ ] æ•°æ®åº“å¤‡ä»½/æ¢å¤åŠŸèƒ½
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ–ï¼‰
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] UI è§†è§‰æ‰“ç£¨

---

## 12. é™„å½•

### 12.1 ç°æœ‰å·²å®ç°ä»£ç æ¸…å•

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `src-tauri/src/lib.rs` | Tauri Builder é…ç½®ï¼Œæ³¨å†Œ 18 ä¸ªå‘½ä»¤ |
| `src-tauri/src/db.rs` | SQLite åˆå§‹åŒ–ï¼Œ8 å¼ è¡¨å»ºè¡¨è¯­å¥ |
| `src-tauri/src/commands/record.rs` | æ£€æŸ¥è®°å½• CRUD (5 ä¸ªå‘½ä»¤) |
| `src-tauri/src/commands/file.rs` | æ–‡ä»¶ç®¡ç† (4 ä¸ªå‘½ä»¤) |
| `src-tauri/src/commands/project.rs` | æ£€æŸ¥é¡¹ç›® CRUD (4 ä¸ªå‘½ä»¤) |
| `src-tauri/src/commands/indicator.rs` | æ£€æŸ¥æŒ‡æ ‡ CRUD (4 ä¸ªå‘½ä»¤) |
| `src-tauri/src/commands/config.rs` | ç³»ç»Ÿé…ç½® (2 ä¸ªå‘½ä»¤) |
| `src/router/index.js` | 3 ä¸ªé¡µé¢è·¯ç”± (upload/trends/settings) |
| `src/components/layout/` | æ— è¾¹æ¡†çª—å£å¸ƒå±€ç»„ä»¶ |

### 12.2 å…³é”®ä¾èµ–ç‰ˆæœ¬é”å®š

| ä¾èµ– | å½“å‰ç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|------|
| tauri | 2.10 | æ¡Œé¢åº”ç”¨æ¡†æ¶ |
| rusqlite | 0.34 | bundled æ¨¡å¼ï¼ˆè‡ªå¸¦ SQLiteï¼‰ |
| reqwest | 0.12 | å« json + stream + socks features |
| vue | 3.5.24 | Composition API |
| element-plus | 2.13.1 | UI ç»„ä»¶åº“ |
| tailwindcss | 4.1.18 | åŸå­åŒ– CSS |
| echarts | 6.0.0 | å›¾è¡¨åº“ |
